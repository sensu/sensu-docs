{{ partial "head" . }}

<script type="text/javascript" src="{{ "/javascripts/application.js" | absURL }}"></script>

{{ if (eq (trim .Site.Params.provider " " | lower) "github") | and (isset .Site.Params "repo_url") }}
  {{ $repo_id := replace .Site.Params.repo_url "https://github.com/" ""}}
  {{ .Scratch.Set "repo_id" $repo_id }}
{{ end }}

<div class="backdrop">
  <div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
  {{ partial "header" . }}
</header>

<main class="main">
  <div class="drawer">
    {{ partial "drawer" . }}
  </div>

  <article class="article">
    <div class="wrapper">
      <h1>{{ .Title }} {{ if .IsDraft }} (Draft){{ end }}</h1>

      {{ if isset .Params "version" }}
        {{ partial "platformDropdown.html" . }}
      {{ end }}
      {{ .Content }}

      <script async type="text/javascript" src="{{"/js/clip.js" | absURL }}"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
      
      {{ partial "pagination.html" . }}
    </div>
  </article>

  <div class="results" role="status" aria-live="polite">
    <div class="scrollable">
      <div class="wrapper">
        <div class="meta"></div>
        <div class="list"></div>
      </div>
    </div>
  </div>
</main>

<footer class="footer">
  {{ partial "footer" . }}
</footer>

<script>
$( document ).ready(function() {
  $cookie = Cookies.get("platform") || "";
  $cookie = $cookie.replace("/", "_");
  $cookie = $cookie.replace(" ", "-");

  togglePlatformDivs();
  applyTipBoxes();
});

function togglePlatformDivs() {
  var $platformCookie = Cookies.get("platform");
  var $platformDivs = document.getElementsByClassName("platform");
  var $hasContentForPlatformCookie = false;

  Array.prototype.forEach.call($platformDivs, function($platformDiv) {
    $platformDivId = $platformDiv.id
    $platformDivId = $platformDivId.replace(new RegExp("-", "g"), " ");
    $platformDivId = $platformDivId.replace(new RegExp("_", "g"), "/");
    if (typeof $platformCookie != 'undefined' && !$platformDivId.includes($platformCookie)) {
      $platformDiv.style.display = 'none';
    } else {
      $hasContentForPlatformCookie = true
      $platformDiv.style.display = 'block';
    }
  });

  // If we don't have any content for the platform cookie, remove it so we go
  // back to the "All Platforms" option and display everything
  if (typeof $platformCookie != 'undefined' && !$hasContentForPlatformCookie) {
    removePlatformCookie();
  }
}

function boldFirstWord(element) {
  newElement = element.html().replace(/(^\w+)/, '<strong>$1</strong>');
  element.html(newElement);
}

function boldFirstTwoWords(element) {
  newElement = element.html().replace(/(^\w+ \w+)/, '<strong>$1</strong>');
  element.html(newElement);
}

function applyTipBoxes() {
  $("em").wrap(function() {
    if ($(this).text().includes("NOTE:")) {
      boldFirstWord($(this));
      return '<div class="note"></div>';
    } else if ($(this).text().includes("WARNING:")) {
      boldFirstWord($(this));
      return '<div class="warning"></div>';
    } else if ($(this).text().includes("PRO TIP:")) {
      boldFirstTwoWords($(this));
      return '<div class="pro-tip"></div>';
    }
  });
}
</script>

{{ partial "footer_js" . }}
